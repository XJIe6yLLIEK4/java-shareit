# ShareIt — обзор, архитектура и паттерны

## 1) Назначение проекта
**ShareIt** — сервис обмена вещами между пользователями: владельцы публикуют предметы, пользователи создают бронирования/запросы, оставляют комментарии. Репозиторий — multi‑module:
- **`gateway`** — входная точка (валидация, нормализация заголовков, маршрутизация к `server`).
- **`server`** — доменная логика (вещи, бронирования, запросы, комментарии).

Есть Compose‑оркестрация для локального запуска.

---

## 2) Архитектурные стили и принципы
- **Backends for Frontends / API Gateway**: отдельный **gateway** как тонкий слой кросс‑срезочных задач (валидации, rate‑limit, аудит).
- **Layered Architecture** в `server`: `Controller → Service → Repository/DAO → DB`.
- **DDD‑модуляризация**: агрегаты *Item*, *Booking*, *Request*, *Comment*. Инваринаты домена проверяются в сервисном слое.
- **API‑first + REST**: чёткие контракты, единые коды ошибок.
- **Idempotency** для повторов POST (например, через ключи идемпотентности по заголовку или по командной модели).
- **Event‑driven hints**: события «бронирование подтверждено/отклонено» могут использоваться для построения ленты/уведомлений.

---

## 3) Паттерны и практики
- **DTO/VO + Mapper** (MapStruct/ручные мапперы).
- **Repository**/**Specification** для запросов и фильтрации по состояниям бронирований.
- **Policy/Strategy** для правил доступа (кто может подтверждать/комментировать).
- **Optimistic Locking** (при необходимости) для конкурентных изменений бронирований.
- **Global Exception Handling** (ControllerAdvice) с единым форматом ошибок.
- **Validation** (Bean Validation) на входных DTO и параметрах контроллеров.
- **Rate Limiting** в `gateway` (например, bucket4j) — опционально.

---

## 4) Технологии
- Язык/сборка: **Java**, **Maven**.
- Веб/REST: **Spring Boot**, **Spring Web**, документация через **OpenAPI/Swagger**.
- БД: **PostgreSQL** (или другая реляционная) + миграции **Flyway/Liquibase**.
- Доступ к данным: **Spring Data JPA/JDBC**.
- Инфраструктура: **Docker/Compose**.
- Качество кода: **Checkstyle**, **Lombok**.
- Наблюдаемость: **Actuator**, **Micrometer** (Prometheus/Grafana при необходимости).
- Асинхронные уведомления (опционально): e‑mail/WebSocket/SSE для статусов бронирований.

---

## 5) Тестирование
- **Unit**: JUnit 5, Mockito/AssertJ.
- **Integration**: тесты REST‑контроллеров, репозиториев; **Testcontainers** для БД.
- **Contract/API tests**: позитивные/негативные кейсы через OpenAPI.

---

## 6) Сборка и запуск
```bash
mvn clean package
docker compose up -d
```
Доступ к API осуществляется через `gateway` (порты см. в `compose.yaml`).

---

## 7) Ключевые решения
- Выделение `gateway` снижает связанность и упрощает эволюцию API.
- Слоистая архитектура + чёткие доменные границы облегчают поддержку.
- Единый формат ошибок/валидаций и идемпотентность повышают UX клиента.
